{# 
  Generated by JinjaGenerator for template 'modules/arbre_descendants'
    at 2025-10-29T22:35:34.800199

  Used macros:
  - display_person(xxx)
  - add_to_count(nnn)
  - nb_column(vvv)
  - fam_nb_column(vvv)
  - multiple_marriages(lll)
  - descendants_at_level(xxx, lll, nnn, ttt, fff, www)

  Used includes:
  - buttons_dag

  Used variables:
  - cancel_links (x11)
  - e.i (x2)
  - e.v (x2)
  - e.sp (x1)
  - e.ma (x1)
  - e.im (x1)
  - e.border (x2)
  - xxx.first_name (x6)
  - xxx.surname (x6)
  - xxx.occ (x8)
  - xxx.index (x5)
  - xxx.has_sosa (x1)
  - xxx.is_restricted (x1)
  - xxx.public_name (x4)
  - xxx.dates (x2)
  - xxx.has_image (x1)
  - xxx.image_url (x2)
  - xxx (x2)
  - xxx.is_female (x1)
  - xxx.is_male (x1)
  - xxx.has_families (x1)
  - wizard (x5)
  - e_im (x1)
  - bvar.default_image (x1)
  - bvar.default_image_no (x1)
  - images_prefix (x1)
  - nnn (x6)
  - incr_count (x4)
  - has_families (x3)
  - vvv (x1)
  - nb_families (x3)
  - mmm (x1)
  - has_children (x1)
  - reset_count (x2)
  - count (x2)
  - lll (x7)
  - evarv (x4)
  - nb_children (x1)
  - baseindex (x1)
  - reset_count1 (x1)
  - e_sp (x3)
  - count1 (x1)
  - index (x1)
  - e_v (x1)
  - v (x6)
  - icount (x5)
#}

<!-- $Id: modules/arbre_descendants.txt v7.1 01/03/2025 19:03:50 $ -->
{% macro display_person(xxx) %}
    <div class="px-0 mx-0 border-0">
        {% if not cancel_links %}
            <a href="{% if e.i == "" %}{{ url_set("p/n/oc/m/t", xxx.first_name+"/"+xxx.surname+"/"+(xxx.occ) if (xxx.occ != 0)+"/D/V") }}{% else %}{{ url_set("i/m/t", xxx.index+"/D/V") }}{% endif %}"
               title="{{ _("navigation") |capitalize }}"></a>
        </a>
    {% endif %}
    {% if xxx.has_sosa %}
        {{ display_sosa("xxx") }}
        <br>
    {% endif %}
    {% if cancel_links or xxx.is_restricted %}
        {% if xxx.public_name != "" %}
            {{ xxx.public_name }}
        {% else %}
            {{ xxx.first_name }}
        {% endif %}
        <span class="text-nowrap">{{ xxx.surname }}</span>
    {% else %}
        <a class="normal_anchor"
           href="{% if e.i == "" %}{{ url_set("p/n/oc/m/t", xxx.first_name+"/"+xxx.surname+"/"+(xxx.occ) if (xxx.occ != 0)) }}{% else %}{{ url_set("i/m/t", xxx.index) }}{% endif %}"
           title=" {{ xxx.first_name }}{% if xxx.occ != "0" %}.{{ xxx.occ }}{% endif %} {{ xxx.surname }}">
            {% if xxx.public_name != "" %}
                {{ xxx.public_name }}
            {% else %}
                {{ xxx.first_name }}
            {% endif %}
            <span class="text-nowrap">{{ xxx.surname }}</span>
        </a>
    {% endif %}
    {% if wizard and not cancel_links %}
        <a class="normal_anchor"
           href="/m=MOD_IND;i={{ xxx.index }}"
           title="{{ _("modify::") |capitalize }} {{ xxx.first_name }}{% if xxx.occ != "0" %}.{{ xxx.occ }}{% endif %} {{ xxx.surname }}">
        {% endif %}
        <span class="font-italic">
            {% if xxx.dates != "" %}
                {{ xxx.dates }}
            {% else %}
                {% if wizard and not cancel_links %}
                    -
                {% else %}
                    {% if cancel_links %}<br>{% endif %}
                {% endif %}
            {% endif %}
        </span>
        {% if wizard and not cancel_links %}</a>{% endif %}
    <br>
    {% if e_im == 1 %}
        {% if xxx.has_image %}
            {% if not cancel_links %}
                <a href="{{ xxx.image_url }}"
                   class="normal_anchor"
                   target="_blank"
                   title="{{ _('image/images', variant='0') |capitalize }} {{ xxx }}">
                {% endif %}
                <img class="small_image {% if not cancel_links %}fade_image{% endif %} align-self-center rounded ml-0 pr-0"
                     src="{{ xxx.image_url }}"
                     alt="{{ _('image/images', variant='0') }}">
                {% if not cancel_links %}</a>{% endif %}
        {% else %}
            {% if bvar.default_image == "yes" %}
                {% if wizard and not cancel_links %}
                    <a href="/m=SND_IMAGE;i={{ xxx.index }}"
                       class="normal_anchor"
                       target="_blank"
                       title="{{ a_of_b(_('add picture') |capitalize, xxx) }}">
                    {% endif %}
                    <img class="small_image align-self-center rounded ml-0"
                         style="height:70%"
                         src="{{ images_prefix }}img_unknown_{% if xxx.is_female %}wo{% else %}{% if xxx.is_male %}{% else %}u_{% endif %}{% endif %}man.png"
                         alt="{{ _("missing image") }}">
                    {% if wizard and not cancel_links %}</a>{% endif %}
            {% else %}
                <span class="small_image noimage rounded display-4 text-centertext-muted ml-0 h-100">{{ bvar.default_image_no }}</span>
            {% endif %}
        {% endif %}
    {% endif %}
</div>
{% endmacro %}
{% macro add_to_count(nnn) %}
    {% for i in range(0, nnn) %}{{ incr_count }}{% endfor %}
{% endmacro %}
{% macro nb_column(vvv) %}
    {% if has_families %}
        {% if vvv == 0 %}
            {% with %}
                {% set mmm = (nb_families) if (nb_families > 1) else ("1") %}{{ add_to_count(mmm) }}
            {% endwith %}
        {% else %}
            {# foreach not implemented yet #}{% endif %}{% else %}{{ incr_count }}{% endif %}{% endmacro %}{% macro fam_nb_column(vvv) %}{% if has_children %}{# foreach not implemented yet #}{% else %}{{ incr_count }}{% endif %}{% endmacro %}{% macro multiple_marriages(lll) %}{{ reset_count }}{% if nb_families > 1 %}{{ incr_count }}{% endif %}{# foreach not implemented yet #}{{ count }}
        {% endmacro %}
        {% macro descendants_at_level(xxx, lll, nnn, ttt, fff, www) %}
            {% if lll > evarv %}
            {% else %}
                {% if lll <= nnn %}
                    {% if lll == nnn and "xxx" != "" %}
                        {% with %}
                            {% set has_multiple_marriages = "1" %}
                            {% if "ttt" == "hbarc" and lll > 0 and "xxx" != "self" %}
                                {% if "fff" == "none" %}
                                    <td colspan="www" class="text-center"></td>
                                    <td></td>
                                {% else %}
                                    <td colspan="www" class="text-fff">
                                        <hr class="fff">
                                    </td>
                                    <td>
                                        {% if "fff" == "full" or "fff" == "right" %}<hr class="full">{% endif %}
                                    </td>
                                {% endif %}
                            {% else %}
                                {% if "ttt" == "vbar" and lll > 0 and "xxx" != "self" %}
                                    {% if nb_children > 0 %}
                                        <td colspan="www" class="text-center">│</td>
                                        <td>&nbsp;</td>
                                    {% else %}
                                        <td colspan="www" class="text-center"></td>
                                        <td>&nbsp;</td>
                                    {% endif %}
                                {% else %}
                                    {% if "ttt" == "person" and "xxx" != "" %}
                                        <td colspan="www" class="text-center align-top">
                                            {% if xxx.index != baseindex %}│{% endif %}
                                            {{ display_person("xxx") }}
                                            {% if xxx.has_families %}
                                                {{ reset_count1 }}{# foreach not implemented yet #}{% if not e_sp == 1 and nnn < evarv - 1 and count1 > 0 %}│{% endif %}{% if e_sp == 1 and lll == nnn %}{% with %}{% set test = has_relation() %}{# foreach not implemented yet #}
                                            {% endwith %}
                                        {% endif %}
                                    {% endif %}
                                </td>
                                <td>&nbsp;</td>
                            {% else %}
                                {% if "ttt" == "skip" %}
                                    <td></td>
                                    <td></td>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endif %}
                    {% if has_families %}
                        {# foreach not implemented yet #}
                    {% else %}
                        {% if "ttt" == "spouse" or "ttt" == "vbars" or "ttt" == "hbars" %}
                            <td></td>
                            <td></td>
                        {% endif %}
                    {% endif %}
                {% endwith %}
            {% else %}
                {% if "ttt" != "skip" %}
                    {% if has_families %}
                        {# foreach not implemented yet #}
                    {% else %}
                        <td></td>
                        <td></td>
                    {% endif %}
                {% else %}
                    {% if "ttt" == "skip" %}{{ descendants_at_level("none", lll + 1, nnn, "skip", 0) }}{% endif %}
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}
{% endmacro %}
{% with %}
    {% set e_v = (e.v) if (e.v != "") else ("3") %}
    {% with %}
        {% set e_sp = ("0") if (e.sp != "") else ("1") %}
        {% with %}
            {% set e_ma = ("0") if (e.ma != "") else ("1") %}
            {% with %}
                {% set e_im = ("0") if (e.im != "") else ("1") %}
                {% with %}
                    {% set evarborder = ("0") if (e.border == "" or e.border == "0") else ("1") %}
                    {% with %}
                        {% set baseindex = index %}
                        <h3 id="a">{{ _("descendants tree") |capitalize }}</h3>
                        {% include 'buttons_dag.html.j2' %}
                        {{ reset_count }}
                        {% with %}
                            {% set evarv = e_v + 1 %}{{ nb_column(evarv + 1) }}
                            {% with %}
                                {% set icount = -1 %}
                                <table class="destree_table mt-3 mx-auto">
                                    {% for v in range(0, evarv) %}
                                        {% if v != 0 %}<tr>{{ descendants_at_level("self", 0, v, "hbarc", "center", icount) }}</tr>{% endif %}
                                        <tr>{{ descendants_at_level("self", 0, v, "person", "center", icount) }}</tr>
                                        <tr>{{ descendants_at_level("self", 0, v, "hbars", "center", icount) }}</tr>
                                        {% if e_sp == 1 %}<tr>{{ descendants_at_level("self", 0, v, "spouse", "center", icount) }}</tr>{% endif %}
                                        <tr>{{ descendants_at_level("self", 0, v, "vbars", "center", icount) }}</tr>
                                    {% endfor %}
                                </table>
                            {% endwith %}
                        {% endwith %}
                    {% endwith %}
                {% endwith %}
            {% endwith %}
        {% endwith %}
    {% endwith %}
{% endwith %}
