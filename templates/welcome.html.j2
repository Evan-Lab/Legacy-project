{# --------------------------------------------------------------------
  Ported from: welcome.txt v7.1 (16/02/2025 17:11:01)
  Notes:
  - Legacy [* ... ] tokens looked like i18n lookups. I map them via {{ t("a/b/c", idx) }}
    where t() should be a callable you provide (see “Required variables” below).
  - For inline bilingual blocks like:
        [en: foo
         fr: bar]
    use {{ i18n_block({'en':'foo','fr':'bar'}) }}. I preserved those blocks using that helper.
  - Any legacy %apply;capitalize%... becomes the Jinja2 filter |capitalize.
  - Any dynamic b.some_field built from a variable uses b[...] dict access.
  - Anything that looked like “function” (e.g. url_set.lang_file, language_name, uri_encode)
    is called as a function you provide in the context.
  -------------------------------------------------------------------- #}

{# ------------------------- Macros / helpers ------------------------- #}
{% macro book_of(xx) -%}book of {{ xx }}{%- endmacro %}

{% macro dl(xx) -%}
  {# originally: if (b.datalist_xx = 1) #}
  {% if b['datalist_' ~ xx] == 1 %}
    <datalist id="datalist_{{ xx }}"></datalist>
  {% endif %}
{%- endmacro %}

{{ dl('fnames') }}
{{ dl('snames') }}
{{ dl('titles') }}
{{ dl('estates') }}

{% macro display_sosa_ref(sosa_ref) -%}
  {{ t('*sosa reference', 0) }}:
  <a href="{{ prefix }}{{ sosa_ref.access }}">{{ sosa_ref.value }}</a>
{%- endmacro %}

{% macro get_visitor_access_msg(lg) -%}
  {# prefer b.visitor_access_msg_<lg>, else _en, else literal fallback #}
  {% set key = 'visitor_access_msg_' ~ lg %}
  {% if b.get(key, '') %}
    {{ b[key] | safe }}
  {% elif b.get('visitor_access_msg_en','') %}
    {{ b['visitor_access_msg_en'] | safe }}
  {% else %}
    [restricted access]
  {% endif %}
{%- endmacro %}

{# get_random delegates to a callable you provide: random_pick(kind: str) -> Any #}
{% macro get_random(kind) -%}{{ random_pick(kind) }}{%- endmacro %}

{% macro notes_title(lang) -%}
  {% if b.get('base_notes_title_' ~ lang, '') %}
    {{ b['base_notes_title_' ~ lang] }}
  {% elif b.get('base_notes_title','') %}
    {{ b['base_notes_title'] }}
  {% else %}
    {{ t('*base notes', 0) }}
  {% endif %}
{%- endmacro %}

{% macro book_button(xxx, yyy, zzz) -%}
  <a role="button" class="btn btn-outline-success" data-toggle="tooltip"
     href="{{ prefix }}m=MOD_DATA&data={{ xxx }}"
     title="{{ t('*modify', 0) }} {{ book_of(yyy[1]) }} ({{ t('wizard/wizards/friend/friends/exterior', 0) }})">
    <i class="fa fa-{{ zzz }} fa-fw mr-1"></i>
    <span class="text-nowrap">{{ t(yyy[0], 1) }}</span>
  </a>
{%- endmacro %}

{# language list from legacy macro #}
{% set _languages = [
  'af','ar','bg','br','ca','co','cs','da','de','en','eo','es','et','fi','fr','he','is','nn',
  'it','lt','lv','nl','no','oc','pl','pt','pt-br','ro','ru','sk','sl','sv','tr','zh'
] %}

{% macro set_lang(l1) -%}
  {{ url_set.lang_file(l1) if default_lang != l1 else url_set.lang_file() }}
{%- endmacro %}

{% macro language_link() -%}
  {% for l1 in _languages %}
    {% if lang != l1 %}
      <a class="dropdown-item{% if l1 == b.default_lang %} bg-warning{% endif %}" id="lang_{{ l1 }}"
         href="{{ set_lang(l1) }}">
        <code>{% if l1 != 'pt-br' %}{{ l1 }}&nbsp;&nbsp;&nbsp;{% else %}{{ l1 }}{% endif %} </code>
        {{ language_name(l1) | capitalize }}
      </a>
    {% endif %}
  {% endfor %}
{%- endmacro %}

<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <title>GeneWeb – {{ base.name }}</title>
  <meta name="robots" content="none">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="{{ images_prefix }}favicon_gwd.png">
  <link rel="apple-touch-icon" href="{{ images_prefix }}favicon_gwd.png">
  {# legacy %include;css -> include partial #}
  {# {% include 'css.html.j2' %} #}
</head>
<body{{ body_prop|safe }}>
<div class="container" id="welcome">

{# %include;hed #}
{# {% include 'hed.html.j2' %} #}

{# ---------------------- Error banner (e.*) ------------------------- #}
{% if e.i or e.p or e.n or e.pn %}
  <div class="d-flex justify-content-center">
    <div class="alert alert alert-danger alert-dismissible fade show text-center w-75 m-2" role="alert">
      {% if e.i %}{{ t('*unknown index',0) }}: {{ e.i }}
      {% elif e.pn %}{{ t('*unknown person',0) }}: {{ e.pn }}
        {% if e.p %} {{ e.p }}{% endif %}{% if e.n %} {{ e.n }}{% endif %}
      {% elif e.p and not e.n %}{{ t('*unknown first_name',0) }}: {{ e.p }}
      {% elif e.n and not e.p %}{{ t('*unknown surname',0) }}: {{ e.n }}
      {% else %}{{ t('*unknown person',0) }}: {{ e.p }}{% if e.oc %}.{{ e.oc }}{% endif %} {{ e.n }}{% endif %}
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  </div>
{% endif %}

<div class="d-flex flex-column flex-md-row align-items-center justify-content-lg-around mt-1 mt-lg-{% if roglo %}1{% else %}3{% endif %}">
  <div class="col-md-3 order-2 order-md-1 align-self-center mt-3 mt-md-0">
    <div class="d-flex justify-content-center">
      {% if roglo %}
        <img src="{{ images_prefix }}logo-roglo.png" alt="logo Roglo" width="150">
      {% elif b.welcome_logo %}
        <img src="{{ prefix }}m=IM;s={{ b.welcome_logo }}" alt="logo"
             {% if b.welcome_logo_style %}style="{{ b.welcome_logo_style }}"{% endif %}>
      {% else %}
        <img src="{{ images_prefix }}arbre_start.png" alt="logo GeneWeb" width="180">
      {% endif %}
    </div>
  </div>

  <div class="col-12 col-md-3 order-1 order-md-3 ml-md-2 px-0 mt-xs-2 mt-lg-0 align-self-center">
    <div class="d-flex flex-column col-md-10 pl-1 pr-0">

      {% if cgi and (not wizard or not friend) %}
        <form class="form-inline" method="post" action="{{ action }}">
          {{ hidden | safe }}
          <div class="input-group mt-1">
            <label for="w" class="sr-only">{{ t('user/password/cancel',0) }}:{{ t('user/password/cancel',1) }}</label>
            <input type="password" name="w" class="form-control"
              title="{{ t('wizard/wizards/friend/friends/exterior',2) }}/{{ t('wizard/wizards/friend/friends/exterior',0) }}"
              placeholder="{{ t('user/password/cancel',0) }}:{{ t('user/password/cancel',1) }}"
              aria-label="password input" aria-describedby="username:password" autofocus>
            <div class="input-group-append">
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </div>
        </form>
      {% endif %}

      {% if not b.auth_file %}
        <div class="btn-group btn-group-xs mt-1" role="group">
        {% if b.friend_passwd or b.friend_passwd_file %}
          {% if not friend %}
            {% if not cgi %}
              <a href="{{ url_set.w('f') }}" class="btn btn-sm btn-outline-primary text-nowrap" role="button">
                <i class="fas fa-user mr-2" aria-hidden="true"></i>
                {{ t('wizard/wizards/friend/friends/exterior',2) }}</a>
            {% endif %}
          {% else %}
            <a href="#" class="btn btn-primary btn-sm disabled text-nowrap" role="button">
              <i class="fas fa-user mr-2" aria-hidden="true"></i>
              {{ t('wizard/wizards/friend/friends/exterior',2) }}</a>
          {% endif %}
        {% endif %}

        {% if b.wizard_passwd or b.wizard_passwd_file %}
          {% if not wizard %}
            {% if not cgi %}
              <a href="{{ url_set.w('w') }}" class="btn btn-sm btn-outline-success text-nowrap" role="button">
                <i class="fas fa-hat-wizard mr-2" aria-hidden="true"></i>
                {{ t('wizard/wizards/friend/friends/exterior',0) }}</a>
            {% endif %}
          {% else %}
            <a href="#" class="btn btn-sm btn-success disabled text-nowrap" role="button">
              <i class="fas fa-hat-wizard mr-2" aria-hidden="true"></i>
              {{ t('wizard/wizards/friend/friends/exterior',0) }}</a>
          {% endif %}
        {% endif %}
        </div>
      {% endif %}

      {% set username = user.name if user.name else user.ident %}
      {% if (wizard and (b.wizard_passwd_file or b.wizard_passwd))
            or (friend and (b.friend_passwd_file or b.friend_passwd)) %}
        {% set userk = user.key if user.key else (user.name if user.name else user.ident) %}
        <a class="border border-{% if friend %}primary{% elif wizard %}success{% endif %} text-{% if friend %}primary{% elif wizard %}success{% endif %} rounded text-center mt-1 w-100 rounded-bottom"
           href="{{ prefix }}m=S&pn={{ uri_encode(userk) }}"
           {% if not user.key %}title="{{ t('*no user key',0) }}" data-toggle="tooltip"{% endif %}>
          {% if wizard %}{{ t('wizard/wizards/friend/friends/exterior',0) }}
          {% elif friend %}{{ t('wizard/wizards/friend/friends/exterior',2) }}{% endif %}
          {{ username }}</a>
        <a class="btn btn-sm btn-outline-danger mt-1 w-100" href="{{ prefix }}w=" role="button">
          <i class="fas fa-right-from-bracket mr-1" aria-hidden="true"></i>{{ t('*disconnect',0) }}</a>

        {% if roglo %}
          <div class="btn-group" data-toggle="tooltip" data-placement="left"
               title="{{ language_name(lang) }} – {{ t('*select lang',0) }}">
            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenu1"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="sr-only">lang</span>
              <span class="text-uppercase">{{ lang }}</span>
              <span class="sr-only">, [select lang]</span>
            </button>
            <div class="dropdown-menu scrollable-lang" aria-labelledby="dropdownMenu1">
              {{ language_link() }}
            </div>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <div class="my-0 order-3 order-md-2 flex-fill text-lg-center align-self-md-center">
    <h1 class="font-weight-bolder">{{ t('database',0) | capitalize }} {{ base.name }}</h1>

    {% if b.visitor_access != 'no' or wizard or friend %}
      <div class="d-flex justify-content-center">
        <span class="text-center {% if roglo %}h5{% else %}h4 font-weight-lighter{% endif %}">
          {% if roglo %}
            {{ i18n_block({
              'en':'contains',
              'fr':'contient'
            }) }}
            {{ base.real_nb_persons }}&nbsp;
            {{ i18n_block({
              'en':'individuals<br> all connected through familial relationships',
              'fr':'individus<br> tous reliés par des liens familiaux'
            }) }}
          {% else %}
            {{ base.real_nb_persons }}&nbsp;
            {% if base.real_nb_persons in ['0','1'] %}
              {{ t('person/persons',0) }}
            {% else %}
              {{ t('person/persons',1) }}
            {% endif %}
          {% endif %}
        </span>
        {% if base.real_nb_persons != '0' and not predictable_mode %}
          <a class="align-self-center ml-2 mb-2"
             href="{{ prefix }}i={{ get_random('nb_persons.v') }}"
             data-toggle="tooltip" data-placement="bottom"
             title="{{ t('*random individual',0) }}"><i class="fa-solid fa-dice"></i></a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

<div class="d-flex justify-content-center">
  <div class="d-flex flex-column col-8">
    {% if b.motd %}
      <div class="display-5 lead font-weight-light text-center">{{ interp(b.motd) | safe }}</div>
    {% endif %}
    {% if browsing_with_sosa_ref and b.visitor_access != 'no' %}
      <div class="text-center">{{ display_sosa_ref(sosa_ref) }}</div>
    {% endif %}
  </div>
</div>

{% if just_friend_wizard %}
  <div class="col mt-1">
    <div class="text-center alert alert-danger alert-dismissible fade show" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <span>
        {{ i18n_block({
          'co': 'I <strong>diritti di i maghi</strong> sò attualmente<strong>disattivati</strong> per via d’una mantenenza.',
          'en': '<strong>Wizard rights</strong> are now <strong>suspended</strong> for maintenance.',
          'fr': 'Les <strong>droits des magiciens</strong> sont actuellement <strong>suspendus</strong> pour maintenance.'
        }) | safe }}
      </span>
    </div>
  </div>
{% endif %}

{% if not (b.visitor_access != 'no' or wizard or friend) %}
  {% set lg = lang %}
  <div class="text-lg-center alert alert-danger font-weight-bold" role="alert">
    <i class="fa fa-triangle-exclamation fa-fw mr-2"></i>
    <span>{{ get_visitor_access_msg(lg) }}</span>
    <span class="fa fa-triangle-exclamation fa-fw"></span>
  </div>

{% elif nb_persons.v != 0 %}
  <div id="welcome-search" class="d-flex flex-wrap justify-content-center mt-3 mt-lg-1">
    <div class="col col-md-10 col-xl-9">
      <form id="main-search" class="mt-2 mt-xl-4" method="get" action="{{ prefix }}">
        {{ hidden | safe }}
        <input type="hidden" name="m" value="S" class="has_validation">
        <div class="d-flex justify-content-center">
          <div class="d-flex flex-column justify-content-center w-100">
            <div class="d-flex flex-column flex-md-row">

              <div class="w-100 w-md-auto flex-md-grow-1">

                <div class="d-flex flex-grow-1">
                  <div class="d-flex align-items-center ml-1 mr-2">
                    <abbr data-toggle="tooltip" data-placement="top" data-html="true"
                       title="<div class='text-left font-weight-bold'><h5>{{ t('*search format',0) }}:</h5>
                              1. {{ t('person/persons',0) }}:<br>
                                 a. {{ t('first name/first names',2) }} {{ t('surname/surnames',0) }} ¹<br>
                                     <i class='font-weight-lighter'>John Doe</i><br><br>
                                 b. {{ t('first name/first names',2) }}/{{ t('surname/surnames',0) }} ²/[occ]1 ³<br>
                                     <i class='font-weight-lighter'>James William/Smith-Johnson/2<br>       James William/Smith-Johnson<br>
                                     James William/<br>       /Smith-Jonhson</i><br><br>
                              2. {{ t('surname/surnames',0) }} ¹: <i class='font-weight-lighter'>Doe</i><br><br>
                              3. {{ t('*public name',0) }}: <i class='font-weight-lighter'>James Smith</i><br><br>
                              4. {{ t('*alias',0) }}: <i class='font-weight-lighter'>Jimmy</i><br><br>
                              5. {{ t('*key',0) }}: {{ t('first name/first names',2) }}.[occ]1 {{ t('surname/surnames',0) }} ²<br>
                                     <i class='font-weight-lighter'>James William.2 Smith-Johnson<br>       james william.2 smith johnson</i><br>
                              <br><div class='font-weight-lighter small'>¹ {{ t('word/words',0) }}<br>² {{ t('word/words',1) }}<br>³ {{ t('optional/mandatory',0) }}</div></div>">
                      <i class="far fa-circle-question text-primary text-primary"></i>
                    </abbr>
                  </div>
                  <input type="search" id="fullname" class="form-control form-control-lg py-0 border border-top-0" autofocus tabindex="1"
                    name="pn" placeholder="{{ t('search/case sensitive',0) }} {{ t('person/persons',0) }}, {{ t('surname/surnames',0) }}, [public name], [alias], {{ t('key',0) }}{% if browsing_with_sosa_ref %}, [n° Sosa]{% endif %}"
                    {% if e.pn %} value="{{ e.pn }}"{% endif %}>
                </div>

                <div class="d-flex mt-3">
                  <div class="btn-group-vertical mr-2">
                    <a role="button" href="{{ prefix }}m=P&tri=A" data-toggle="tooltip"
                      title="{{ t('first name/first names',1) }}, {{ t('sort by/date begin/alphabetic order/nb individuals/nb events',0) }} {{ t('display by/branch/alphabetic order',2) }}">
                      <i class="fa fa-arrow-down-a-z fa-fw"></i></a>
                    <a role="button" href="{{ prefix }}m=P&tri=F" data-toggle="tooltip"
                      title="{{ t('*frequency',0) }} {{ t('first name/first names',1) }}, {{ t('sort by/date begin/alphabetic order/nb individuals/nb events',0) }} {{ t('sort by/date begin/alphabetic order/nb individuals/nb events',3) }}">
                      <i class="fa fa-arrow-down-wide-short fa-fw"></i></a>
                  </div>
                  <div class="d-flex flex-grow-1">
                    <div class="flex-grow-1 align-self-center">
                      <label for="firstname" class="sr-only col-form-label">{{ t('first name/first names',2) }}</label>
                      <input type="search" id="firstname" class="form-control form-control-lg border-top-0"
                        name="p" placeholder="{{ t('first name/first names',2) }}" tabindex="2"
                        {% if e.p %} value="{{ e.p }}"{% endif %} list="datalist_fnames" data-book="fn">
                    </div>
                  </div>
                </div>

                <div class="d-flex mt-2">
                  <div class="btn-group-vertical mr-2">
                    <a role="button" href="{{ prefix }}m=N&tri=A" data-toggle="tooltip"
                      title="{{ t('surname/surnames',1) }}, {{ t('sort by/date begin/alphabetic order/nb individuals/nb events',0) }} {{ t('display by/branch/alphabetic order',2) }}">
                      <i class="fa fa-arrow-down-a-z fa-fw"></i></a>
                    <a role="button" href="{{ prefix }}m=N&tri=F" data-toggle="tooltip"
                      title="{{ t('*frequency',0) }} {{ t('surname/surnames',1) }}, {{ t('sort by/date begin/alphabetic order/nb individuals/nb events',0) }} {{ t('sort by/date begin/alphabetic order/nb individuals/nb events',3) }}">
                      <i class="fa fa-arrow-down-wide-short fa-fw"></i></a>
                  </div>
                  <div class="d-flex flex-grow-1">
                    <div class="flex-grow-1 align-self-center">
                      <label for="surname" class="sr-only col-form-label col-sm-2">{{ t('surname/surnames',0) }}</label>
                      <input type="search" id="surname" class="form-control form-control-lg border border-top-0"
                        title="{{ t('word/words',1) }}" data-toggle="tooltip"
                        name="n" placeholder="{{ t('surname/surnames',0) }}" tabindex="3"
                        {% if e.n %} value="{{ e.n }}"{% endif %} list="datalist_snames" data-book="sn">
                    </div>
                  </div>
                </div>
              </div>

              <div class="d-flex flex-column align-items-center justify-content-between mt-3 mt-md-0 mx-0 mx-md-1 px-0 px-md-3 col-md-auto small">
                <div class="d-flex flex-row flex-md-column justify-content-start mb-3 mb-md-0">
                  <div class="align-self-md-start font-weight-bold mr-3 mr-md-0 mb-0 mb-md-1">{{ t('first name/first names',1) }}:</div>
                  <div class="d-flex flex-row flex-md-column">
                    <div class="custom-control custom-checkbox mr-3 mr-md-0 mb-md-1" data-toggle="tooltip" data-placement="{{ 'top' if b.propose_titles == 'no' else 'left' }}" title="{{ t('*not all hlp',0) }}">
                      <input class="custom-control-input" type="checkbox" name="p_all" id="p_all" value="off" tabindex="4">
                      <label class="custom-control-label d-flex align-items-center" for="p_all">{{ t('*not all',0) }}</label>
                    </div>
                    <div class="custom-control custom-checkbox mr-3 mr-md-0 mb-md-1" data-toggle="tooltip" data-placement="{{ 'top' if b.propose_titles == 'no' else 'left' }}" title="{{ t('*order hlp',0) }}">
                      <input class="custom-control-input" type="checkbox" name="p_order" id="p_order" value="on" tabindex="5">
                      <label class="custom-control-label d-flex align-items-center" for="p_order">{{ t('*order',0) }}</label>
                    </div>
                    <div class="custom-control custom-checkbox" data-toggle="tooltip" data-placement="{{ 'top' if b.propose_titles == 'no' else 'left' }}" title="{{ t('*not exact hlp',0) }}">
                      <input class="custom-control-input" type="checkbox" name="p_exact" id="p_exact" value="off" tabindex="6">
                      <label class="custom-control-label d-flex align-items-center" for="p_exact">{{ t('*not exact',0) }}</label>
                    </div>
                  </div>
                </div>

                <button id="global-search-inline" class="{% if b.propose_titles != 'no' %}d-none {% endif %}btn btn-outline-primary font-weight-bolder w-100 w-md-auto py-2 mb-1"
                        type="submit"{% if b.propose_titles == 'no' %} tabindex="7"{% endif %}>
                  <i class="fa fa-magnifying-glass fa-lg fa-fw"></i>
                  {{ t('search/case sensitive',0) }}
                </button>
              </div>
            </div>

            {# surname options block kept as-is; toggles shown only if needed in your UI #}
          </div>
        </div>
      </form>

      <div class="d-flex flex-wrap flex-md-no-wrap justify-content-center align-items-md-center mt-1 mt-md-3">
        {% if b.propose_titles != 'no' %}
          <form id="title-search" class="d-flex flex-column flex-md-row align-items-start align-items-md-center col-12 col-md-9 ml-md-4" method="get" action="{{ action }}">
            {{ hidden | safe }}
            <input type="hidden" name="m" value="TT">
            <div class="d-flex align-items-center w-100 mb-2 mb-md-0">
              <a class="mr-2" role="button" data-toggle="tooltip" data-placement="bottom"
                 href="{{ prefix }}m=TT" title="{{ t('*all the titles',0) }}"><i class="fa fa-list-ul fa-fw"></i></a>
              <label for="titles" class="sr-only col-form-label">{{ t('title/titles',0) }}</label>
              <input type="search" class="form-control border-top-0 border-right-0 border-left-0 w-100"
                     name="t" id="titles" placeholder="{{ t('title/titles',0) }}" tabindex="7"
                     list="datalist_titles" data-book="title">
            </div>
            <div class="d-flex align-items-center w-100 mb-2 mb-md-0 ml-0 ml-md-2">
              <a class="mr-2" role="button" data-toggle="tooltip" data-placement="bottom"
                 href="{{ prefix }}m=TT&p=*" title="{{ t('*all the estates',0) }}"><i class="fa fa-list-ul fa-fw"></i></a>
              <label for="estates" class="sr-only col-form-label">{{ t('estate',0) }}</label>
              <input type="search" class="form-control border-top-0 border-right-0 border-left-0 w-100"
                     name="p" id="estates" placeholder="{{ t('estate',0) }}" tabindex="8"
                     list="datalist_estates" data-book="domain">
            </div>
            <button class="d-none" type="submit"></button>
          </form>
        {% endif %}

        {% if b.propose_titles != 'no' %}
          <button id="global-search" class="btn btn-outline-primary font-weight-bolder col-12 col-md-auto mt-1 mt-md-0 {% if b.propose_titles != 'no' %}ml-md-auto mr-md-2 py-2{% else %}py-2{% endif %}"
                  type="submit"
                  tabindex="{{ 9 if b.propose_titles != 'no' else 7 }}"
                  data-toggle="tooltip" data-placement="right">
            <i class="fa fa-magnifying-glass fa-lg fa-fw"></i>
            {{ t('search/case sensitive',0) }}
          </button>
        {% endif %}
      </div>
    </div>
  </div>
{% endif %}

<div class="d-flex flex-column justify-content-start justify-content-md-center mt-4 col-12 col-md-11 col-lg-8 mx-auto">
  <div class="h4 text-md-center"><i class="fas fa-screwdriver-wrench fa-sm fa-fw text-secondary"></i>
    {% if roglo %}
      {{ i18n_block({'en':'Around the tree','fr':"Autour de l'arbre"}) }}
    {% else %}
      {{ t('*tools',0) }}
    {% endif %}
  </div>
  <div class="d-flex flex-wrap justify-content-md-center">

    {% if wizard and not base.has_notes %}
      <a role="button" class="btn btn-outline-success" href="{{ prefix }}m=MOD_NOTES">
        <i class="far fa-file-lines fa-fw mr-1" aria-hidden="true"></i>{{ t('*add base notes',0) }}
      </a>
    {% endif %}

    {% if base.has_notes %}
      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=NOTES">
        <i class="far fa-file-lines fa-fw mr-1" aria-hidden="true"></i>{{ notes_title(lang) }}
      </a>
    {% endif %}

    {% if has_misc_notes %}
      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=MISC_NOTES">
        <i class="fas fa-align-justify fa-fw mr-1" aria-hidden="true"></i>
        {{ t('*base index notes',0) }}</a>
    {% endif %}

    {% if (wizard or friend) and (b.wizard_passwd_file or b.wizard_descr_file) %}
      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=WIZNOTES">
        <i class="far fa-file-lines fa-fw mr-1" aria-hidden="true"></i>{{ t('*base wizard notes',0) }}</a>
    {% endif %}

    {% if nb_persons.v != 0 %}
      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=STAT">
        <i class="far fa-chart-bar fa-fw mr-1" aria-hidden="true"></i>{{ t('*statistics',0) }}</a>
      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=ANM">
        <i class="fa fa-cake-candles fa-fw mr-1" aria-hidden="true"></i>{{ t('*anniversaries',0) }}</a>
      {% if has_history and b.history == 'yes' %}
        <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=HIST&k=20">
          <i class="fas fa-clock-rotate-left fa-fw mr-1" aria-hidden="true"></i>{{ t('*history',0) }}</a>
      {% endif %}
    {% endif %}

    {% if plugin.forum and b.disable_forum != 'yes' %}
      <a class="btn btn-outline-primary" href="{{ prefix }}m=FORUM">
        <i class="far fa-comments fa-fw mr-1" aria-hidden="true"></i>{{ t('*forum',0) }}</a>
    {% endif %}

    {% if b.propose_place_surnames != 'no' and nb_persons.v != 0 %}
      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=PPS&bi=on&ba=on&ma=on&de=on&bu=on">
        <i class="fas fa-globe fa-fw mr-1" aria-hidden="true"></i>{{ t('place/places',1) }}/{{ t('surname/surnames',0) }}</a>
    {% endif %}

    {% if b.hide_advanced_request == 'no' %}
      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=AS">
        <i class="fa fa-magnifying-glass-plus fa-fw mr-1" aria-hidden="true"></i>{{ t('*advanced request',0) }}</a>
    {% endif %}

    <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=CAL">
      <i class="far fa-calendar-days fa-fw mr-1" aria-hidden="true"></i>{{ t('calendar/calendars',1) }}</a>

    {% if wizard %}
      <a role="button" class="btn btn-outline-success" href="{{ prefix }}m=H&v=conf">
        <i class="fas fa-gear fa-fw mr-1" aria-hidden="true"></i>{{ t('*configuration',1) }}</a>
      <a role="button" class="btn btn-outline-success" href="{{ prefix }}m=MOD_NOTES&f=new_note">
        <i class="fa fa-file-lines fa-fw mr-1" aria-hidden="true"></i>{{ t('add::note/notes',0) }}</a>
      {% if b.propose_add_family != 'no' %}
        <a role="button" class="btn btn-outline-success" href="{{ prefix }}m=ADD_FAM">
          <i class="fas fa-user-plus fa-fw mr-1" aria-hidden="true"></i>{{ t('add::family/families',0) }}</a>
      {% endif %}
    {% endif %}

    {% if (not roglo) and b.alt_serv_base and not cgi %}
      <a role="button" class="btn btn-outline-primary"
         href="{% if b.alt_serv_adr %}{{ b.alt_serv_adr }}{% endif %}{{ b.alt_serv_base }}?w={% if wizard %}w{% elif friend %}f{% endif %}{% for env in env_binding %}{% if env.key and env.key != 'w' %}&{{ env.key }}={{ env.val }}{% endif %}{% endfor %}"
         title="{{ t('*go to alt base',0) }} {{ b.alt_serv_base }}">
        {{ b.alt_serv_title if b.alt_serv_title else t('*other base',0) }}
      </a>
    {% endif %}
  </div>
</div>

{% if roglo %}
  <div class="d-flex flex-column justify-content-start justify-content-md-center mt-3 col-12 col-md-10 mx-auto">
    <div class="h4 text-md-center">
      <img src="{{ images_prefix }}logo-roglo.png" alt="Roglo" style="width:30px">
      Association Roglo
    </div>
    <div class="d-flex flex-wrap justify-content-md-center">
      {% if b.alt_serv_base and not cgi %}
        <a role="button" class="btn btn-outline-primary"
           href="{% if b.alt_serv_adr %}{{ b.alt_serv_adr }}{% endif %}{{ b.alt_serv_base }}?w={% if wizard %}w{% elif friend %}f{% endif %}{% for env in env_binding %}{% if env.key and env.key != 'w' %}&{{ env.key }}={{ env.val }}{% endif %}{% endfor %}"
           title="{{ t('*go to alt base',0) }} {{ b.alt_serv_base }}">
          {{ b.alt_serv_title if b.alt_serv_title else t('*other base',0) }}
        </a>
      {% endif %}

      <a role="button" class="btn btn-outline-primary" href="{{ prefix }}m=NOTES&f=0_Sommaire_des_notes_diverses">Encyclopædia Roglo</a>
      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/page/350795-l-association">Site de l’association</a>
      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/page/358570-donnees-personnelles">Politique de confidentialité</a>
      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/page/350796-decouvrir">Fonctionnement et usage</a>
      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/page/358680-contact">Nous contacter</a>

      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/page/419445-s-inscrire-comme-ami">
        {{ i18n_block({'en':'Obtain a <code class="mb-1">Friend</code> access', 'fr':'Obtenir un accès <code class="mb-1">Ami</code>'}) | safe }}
      </a>

      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/collect/description/383016-j-campagne-de-dons-2024-cb-uniquement">
        {{ i18n_block({'en':'Contribute/join', 'fr':'Cotiser/adhérer'}) }}
      </a>

      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/membres/profil">
        {{ i18n_block({'en':'My association account', 'fr':'Mon compte associatif'}) }}
      </a>

      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/page/418348-faq">Questions fréquentes</a>
      <a role="button" class="btn btn-outline-primary" href="https://asso.roglo.eu/page/365469-charte-des-amis">Charte des amis</a>

      {% if roglo and wizard %}
        <a role="button" class="btn btn-outline-success" href="https://asso.roglo.eu/page/358694-charte-des-magiciens">Chartes des Magiciens</a>
        <a role="button" class="btn btn-outline-success" href="https://asso.roglo.eu/page/358695-charte-des-lieux">Chartes des lieux</a>
        <a role="button" class="btn btn-outline-success" href="https://asso.roglo.eu/page/1409612-charte-des-sources">Chartes des sources</a>
        <a role="button" class="btn btn-outline-success" href="https://roglo.eu/wizard_w?lang=fr;m=NOTES;f=GeneWeb:Trucs">Trucs et astuces</a>
        <a role="button" class="btn btn-outline-success" href="https://roglo.eu/wizard_w?lang=fr;m=NOTES;f=Admin:anoma">Anomalies</a>
      {% endif %}
    </div>
  </div>
{% endif %}

{% if (((not roglo and wizard) or (roglo and user.ident and user.ident in b.superwizard)) and nb_persons.v != 0) %}
  <div class="d-flex flex-column justify-content-start justify-content-md-center mt-3 col-12 col-md-8 mx-auto">
    <div class="h4 text-md-center">
      <i class="fas fa-book fa-sm fa-fw text-success mr-1"></i>{{ t('book/books',1) }}
    </div>
    <div class="d-flex flex-wrap justify-content-md-center">
      {{ book_button('fn', ('first name/first names','first name/first names'), 'child') }}
      {{ book_button('sn', ('surname/surnames','surname/surnames'), 'signature') }}
      {{ book_button('pubn', ('public name/public names','public name/public names'), 'pen') }}
      {{ book_button('qual', ('qualifier/qualifiers','qualifier/qualifiers'), 'comment') }}
      {{ book_button('alias', ('alias/aliases','alias/aliases'), 'mask') }}
      {{ book_button('occu', ('occupation/occupations','occupation/occupations'), 'user-doctor') }}
      {{ book_button('place', ('place/places','place/places'), 'map-location-dot') }}
      {{ book_button('src', ('source/sources','source/sources'), 'box-archive') }}
      {{ book_button('title', ('title/titles','title/titles'), 'crown') }}
      {{ book_button('domain', ('domain/domains','domain/domains'), 'chess-rook') }}
      <a href="{{ prefix }}m=CHK_DATA" class="btn btn-outline-success ml-2"
        title="{{ t('*data typographic checker',0) }}"><i class="fas fa-spell-check"></i>
      </a>
    </div>
  </div>
{% endif %}

<div class="d-flex mt-3">
  <div class="col-11 col-md-auto mx-auto">
    {% if b.counter != 'no' %}
      {{ interp(i18n_block({
        'af': 'Daar was ' ~ nb_accesses ~ ' besoeke, ' ~ nb_accesses_to_welcome ~ ' van hulle aan hierdie blad, sedert ' ~ start_date ~ '.',
        'bg': 'От ' ~ start_date ~ ' насам е имало ' ~ nb_accesses ~ ' посещения, от които ' ~ nb_accesses_to_welcome ~ ' са на настоящата страница.',
        'br': 'gweladennoù a zo bet : ' ~ nb_accesses ~ ', er bajenn-mañ : ' ~ nb_accesses_to_welcome ~ ', abaoe an deiz-mañ : ' ~ start_date ~ '.',
        'ca': 'Hi ha hagut ' ~ nb_accesses ~ ' consultes, de les quals ' ~ nb_accesses_to_welcome ~ ' en aquesta pàgina, des del ' ~ start_date ~ '.',
        'co': 'Ci hè statu ' ~ nb_accesses ~ ' cunsultazioni, è ' ~ nb_accesses_to_welcome ~ ' di i quale à sta pagina dapoi u ' ~ start_date ~ '.',
        'cs': nb_accesses ~ ' přístupů, z toho ' ~ nb_accesses_to_welcome ~ ' na tuto stránku, od ' ~ start_date ~ '.',
        'da': 'Der har været ' ~ nb_accesses ~ ' opslag, ' ~ nb_accesses_to_welcome ~ ' af dem på denne side, siden ' ~ start_date ~ '.',
        'de': 'Seit dem ' ~ start_date ~ ' gab es ' ~ nb_accesses ~ ' Zugriffe, davon ' ~ nb_accesses_to_welcome ~ ' auf diese Seite.',
        'en': 'There has been ' ~ nb_accesses ~ ' accesses, ' ~ nb_accesses_to_welcome ~ ' of them to this page, since ' ~ start_date ~ '.',
        'eo': 'Estis ' ~ nb_accesses ~ ' alirejoj, el kiuj ' ~ nb_accesses_to_welcome ~ ' al ĉi tiu paĝo, ekde la ' ~ start_date ~ '.',
        'es': 'Ha habido ' ~ nb_accesses ~ ' consultas, de las cuales ' ~ nb_accesses_to_welcome ~ ' corresponden a esta página, desde el ' ~ start_date ~ '.',
        'et': 'Alates andmebaasi loomise päevast (' ~ start_date ~ ') on selle poole pöördutud ' ~ nb_accesses ~ ' korda, neist ' ~ nb_accesses_to_welcome ~ ' korda sellele lehele.',
        'fi': 'Tähän mennessä ' ~ nb_accesses ~ ' tapahtumaa, joista ' ~ nb_accesses_to_welcome ~ ' tälle sivulle ' ~ start_date ~ ' jälkeen.',
        'fr': 'Il y a eu ' ~ nb_accesses ~ ' consultations, dont ' ~ nb_accesses_to_welcome ~ ' à cette page, depuis le ' ~ start_date ~ '.',
        'he': 'היו ' ~ nb_accesses ~ ' כניסות, כולל ' ~ nb_accesses_to_welcome ~ '; כניסות לעמוד זה, מאז ' ~ start_date ~ '.',
        'is': 'Það hafa verið ' ~ nb_accesses ~ ' heimsóknir, ' ~ nb_accesses_to_welcome ~ ' af þeim á þessa síðu, síðan ' ~ start_date ~ '.',
        'it': 'Dal ' ~ start_date ~ ' ci sono stati ' ~ nb_accesses ~ ' accessi, ' ~ nb_accesses_to_welcome ~ ' dei quali a questa pagina.',
        'lt': 'Iš viso prisijungimų - ' ~ nb_accesses ~ ' lankyta kartų - ' ~ nb_accesses_to_welcome ~ ' iš jų šis puslapis, nuo ' ~ start_date ~ '.',
        'lv': 'Kopš ' ~ start_date ~ ' datu bāze ir apmeklēta ' ~ nb_accesses ~ ' reizes, ' ~ nb_accesses_to_welcome ~ ' no tiem ir bijuši šinī lappusē.',
        'nl': 'Deze paginas zijn sinds ' ~ start_date ~ ' reeds ' ~ nb_accesses ~ ' maal bezocht, waaronder ' ~ nb_accesses_to_welcome ~ ' maal deze verwelkomingspagina.',
        'no': 'Det har vært ' ~ nb_accesses ~ ' aksesser, ' ~ nb_accesses_to_welcome ~ ' av dem til denne siden, siden ' ~ start_date ~ '.',
        'pl': 'Baza została od ' ~ start_date ~ ' odwiedzona ' ~ nb_accesses ~ ' razy (w tym ' ~ nb_accesses_to_welcome ~ ' razy strona tytułowa).',
        'pt': 'Houve ' ~ nb_accesses ~ ' consultas, das quais ' ~ nb_accesses_to_welcome ~ ' foram a esta página, desde ' ~ start_date ~ '.',
        'ro': 'Au avut loc ' ~ nb_accesses ~ ' accese din care ' ~ nb_accesses_to_welcome ~ ' pe aceatsa pagina din ' ~ start_date ~ '.',
        'ru': 'Всего было ' ~ nb_accesses ~ ' обращений, из них ' ~ nb_accesses_to_welcome ~ ' к этой странице, начиная с ' ~ start_date ~ '.',
        'sl': nb_accesses ~ ' dostopov, ' ~ nb_accesses_to_welcome ~ ' od teh na to stran, od ' ~ start_date ~ '.',
        'sv': 'Det har varit ' ~ nb_accesses ~ ' åtkomster, ' ~ nb_accesses_to_welcome ~ ' av dem till den här sidan, sedan ' ~ start_date ~ '.',
        'tr': nb_accesses ~ ' var; erişimler, ' ~ nb_accesses_to_welcome ~ '; ' ~ start_date ~ 'den beri bu sayfaya.',
        'zh': '已经有 ' ~ nb_accesses ~ ' 次访问数据库，其中 ' ~ nb_accesses_to_welcome ~ ' 次访问本主页，自从 ' ~ start_date ~ '。'
      })) | safe }}
    {% endif %}
  </div>
</div>

{# {% include 'trl.html.j2' %} #}
{# {% include 'copyr.html.j2' %} #}

</div>

{# {% include 'js.html.j2' %} #}
{{ query_time | default('') }}
</body>
</html>
