{# 
  Generated by JinjaGenerator for template 'upddata'
    at 2025-10-26T20:24:47.198481

  Used macros:
  - subsection(x)
  - wikidata(x)
  - list_of(xx, yy, zz)
  - other_books()

  Used includes:
  - css
  - hed
  - home
  - trl
  - copyr
  - js

  Used variables:
  - version (x1)
  - lang (x1)
  - title (x2)
  - subtitle (x3)
  - body_prop (x1)
  - e.data (x13)
  - e.s (x14)
  - e.length.s (x1)
  - e.key (x1)
  - b.book_max_results (x5)
  - nb_results (x2)
  - reset_count (x1)
  - len_s (x2)
  - escape.e.s (x1)
  - count (x1)
  - action (x1)
  - hidden (x1)
  - nb_max (x2)
  - query_time (x1)
#}
<!-- $Id: upddata.txt {{ version }} 07/03/2025 04:45:21 $ -->
<!-- Copyright (c) 2006-2007 INRIA -->
<!DOCTYPE html>
<html lang="{{ lang }}" id="book">
    <head>
        <title>{{ title }} – {{ subtitle }}</title>
        <meta name="robots" content="none">
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="shortcut icon"
              href="{{ url_for('static', path='images/favicon_gwd.png') }}">
        {% include 'css.html.j2' %}
    </head>
    <body {{ body_prop }}>
        <div id="loading-overlay"></div>
        {% include 'hed.html.j2' %}
        {% include 'home.html.j2' %}
        {% macro subsection(x) %}
            {{ _("go to section %s:::x") |capitalize }}
        {% endmacro %}
        {% macro wikidata(x) %}
            {{ _("wikidata:::x") |capitalize }}
        {% endmacro %}
        {% macro list_of(xx, yy, zz) %}
            <div {% if ( ( "xx" != "fn" ) or ( e.data != "" ) ) %}class="my-1"{% endif %}>
                {% if ( e.data != "xx" ) %}
                    <a href="/m=MOD_DATA&data=xx"
                       class="sub-char d-flex align-items-center"
                       title="{{ _("book of %s:::yy") |capitalize }}"
                       data-toggle="tooltip"
                       data-placement="right">
                    {% endif %}
                    {% if ( e.data == "" ) %}<div class="d-flex align-self-center">{% endif %}
                        <i class="fa fa-zz fa-2x fa-fw {% if ( e.data == "xx" ) %}text-success{% endif %}"></i>
                        {% if ( e.data == "" ) %}
                            <span class="h4 ml-3">{{ _("book of %s:::yy") |capitalize }}</span>
                        </div>
                    {% endif %}
                    {% if ( e.data != "xx" ) %}</a>{% endif %}
            </div>
        {% endmacro %}
        {% macro other_books() %}
            {% if ( e.data == "" ) %}<div class="h3 mb-3">{{ _("book/books", variant='1') |capitalize }}</div>{% endif %}
            <div class="d-flex flex-column mr-2">
                {{ list_of("fn", _("first name/first names", variant='1') , "child") }}{{ list_of("sn", _("surname/surnames", variant='1') , "signature") }}{{ list_of("pubn", _("public name/public names", variant='1') , "pen") }}{{ list_of("qual", _("qualifier/qualifiers", variant='1') , "comment") }}{{ list_of("alias", _("alias/aliases", variant='1') , "mask") }}
                {% if ( e.data != "" ) %}
                </div>
                <div class="d-flex flex-column mr-2">
                {% endif %}
                {{ list_of("occu", _("occupation/occupations", variant='1') , "user-doctor") }}{{ list_of("place", _("place/places", variant='1') , "map-location-dot") }}{{ list_of("src", _("source/sources", variant='1') , "box-archive") }}{{ list_of("title", _("title/titles", variant='1') , "crown") }}{{ list_of("domain", _("domain/domains", variant='1') , "chess-rook") }}
            </div>
        {% endmacro %}
        <div class="container">
            <a tabindex="4" class="sr-only sr-only-focusable" href="#main-content">{{ _("skip to main content") |capitalize }}</a>
            {% with %}
                {% set len_s = (e.length.s) if (( e.s != "" )) else ("0") %}
                {% with %}
                    {% set nb_max = (b.book_max_results) if (( ( b.book_max_results != "" ) and ( b.book_max_results > 0 ) )) else ("1000") %}
                    <nav class="navbar bg-light sticky-top justify-content-start py-1 mt-1 mb-0 px-1 mx-0"
                         aria-labelledby="sub-caracter-selection-heading"
                         id="fixed-nav">
                        <h2 id="sub-caracter-selection-heading" class="sr-only">
                            {% if ( e.s == "" ) %}
                                {{ _("select a letter") |capitalize }}
                            {% else %}
                                {{ _("hierarchical navigation") |capitalize }}
                            {% endif %}
                        </h2>
                        <div class="btn-group"
                             role="toolbar"
                             aria-label="sub-caracter-selection-heading"
                             id="book-navigation">
                            <div class="d-flex flex-column flex-sm-row list-group list-group-horizontal user-select-none font-weight-bold user-select-none ml-2">
                                <div {% if ( e.s != "" ) %}id="book-sup-char-list"{% endif %}
                                     class="d-inline-flex flex-wrap align-self-center mt-1 mt-sm-0 order-3 text-monospace">
                                    {% if ( nb_results >= 1 ) %}{{ reset_count }}{# foreach not implemented yet #}{% endif %}
                                </div>
                                <div class="d-flex col-xs-12 order-1">
                                    <div class="d-flex flex-row align-self-center">
                                        {% if ( e.s == "" ) %}{{ other_books() }}{% endif %}
                                        {% if ( ( e.data != "" ) and ( e.s == "" ) ) %}
                                            <div class="align-self-center text-center mx-3">
                                                <h1 class="h3 mt-0">{{ _("book/books", variant='0') |capitalize }}</h1>
                                                <h2 class="h4 mt-0 text-nowrap">{{ subtitle }}</h2>
                                            </div>
                                        {% endif %}
                                    </div>
                                    {% if ( e.s != "" ) %}
                                        <a tabindex="5"
                                           role="button"
                                           class="btn-link border-0 align-self-center mt-1 mb-2 sub-char"
                                           href="/m=MOD_DATA&data={{ e.data }}"
                                           title="{{ _("back to index and books") |capitalize }}"
                                           data-toggle="tooltip"
                                           data-placement="bottom">
                                            <span class="fa-stack mb-1">
                                                <i class="fa fa-a fa-stack-2x pr-3"></i>
                                                <i class="fa-solid fa-z fa-2x fa-stack-1x text-success pt-2 pl-3"></i>
                                            </span>
                                        </a>
                                    {% endif %}
                                    {% if ( e.s != "" ) %}
                                        <div class="d-flex flex-grow align-self-sm-center ml-2" id="subinit">
                                            {# foreach not implemented yet #}
                                            {% if ( len_s > 6 ) %}<i class="fa-solid fa-ellipsis align-self-center ml-1"></i>{% endif %}
                                            <div class="list-group-item list-group-item-success text-nowrap user-select-all{% if ( len_s > 1 ) %} ml-1{% endif %}">
                                                {{ escape.e.s }}
                                            </div>
                                        </div>
                                    {% endif %}
                                    <div class="d-flex flex-fill align-self-center order-2 d-xs-none">
                                        {% if ( ( e.s != "" ) and ( count != 0 ) ) %}<i class="fa-solid fa-caret-right align-self-center mx-1"></i>{% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>
                    <div class="d-flex flex-column justify-content-center mx-2">
                        {% if ( e.key != "" ) %}
                            <div class="alert alert-warning w-auto text-center my-2 mx-3 mx-lg-5"
                                 role="alert">
                                <i class="fas fa-hat-wizard fa-fw text-danger mr-1"></i>{{ _("help modify data") |capitalize }}<i class="fas fa-hat-wizard fa-fw text-danger ml-1"></i>
                            </div>
                        {% endif %}
                    </div>
                    {% if ( ( e.data != "" ) and ( e.s != "" ) ) %}
                        <div id="notfound-warning" class="d-none">
                            <div class="d-flex justify-content-center">
                                <div class="alert alert-danger text-center w-auto my-2" role="alert">
                                    <i class="fa fa-exclamation text-danger ml-2"></i>
                                    "<span id="notfound-value"></span>" {{ _("not found") }}
                                </div>
                            </div>
                        </div>
                        <h1 class="text-sm-center mt-0 mt-sm-1 h3">{{ title }}</h1>
                        <h2 class="text-sm-center mt-0 h4">{{ subtitle }}</h2>
                        <div class="mt-2 mt-sm-3 mx-1 mx-sm-3 px-sm-3">
                            <form class="form-inline"
                                  method="get"
                                  action="{{ action }}"
                                  aria-labelledby="search_s">
                                {{ hidden }}
                                <input type="hidden" name="m" value="MOD_DATA">
                                <input type="hidden" name="data" value="{{ e.data }}">
                                <div class="form-group mb-0">
                                    <label class="user-select-none mb-0 mb-sm-1 ml-1 ml-sm-3"
                                           for="search_s"
                                           title="{{ _("search/case sensitive", variant='0') |capitalize }} (R)">
                                        {{ _("search/case sensitive", variant='0') |capitalize }}
                                    </label>
                                    <input type="search"
                                           accesskey="R"
                                           class="form-control ml-2 ml-sm-3"
                                           name="s"
                                           id="search_s">
                                </div>
                                <button type="submit"
                                        class="btn btn-primary ml-2 align-self-end"
                                        title="{{ _("search/case sensitive", variant='0') |capitalize }}"
                                        aria-label="{{ _("validate/delete", variant='0') |capitalize }} {{ _("search/case sensitive", variant='0') }}"
                                        data-toggle="tooltip"
                                        data-placement="right">OK</button>
                            </form>
                        </div>
                    {% endif %}
                    {% if ( ( ( e.data == "place" ) and ( "[" in e.s ) ) or ( "]" in e.s ) ) %}
                        <div class="alert alert-warning my-3">{{ _("subplace help") |capitalize }}</div>
                    {% endif %}
                    {% if ( nb_results < nb_max ) %}
                        <ul class="list-group mt-1 mt-sm-2" id="main-content">
                            {# foreach not implemented yet #}
                        </ul>
                    {% else %}
                        <div class="alert alert-warning my-3">
                            {{ _("too much results") |capitalize }}
                            (>
                            {% if ( b.book_max_results != "" ) %}
                                <abbr title="book_max_results">{{ b.book_max_results }}</abbr>
                            {% else %}
                                {{ nb_max }}
                            {% endif %}
                            ).
                            {% if ( e.s != "" ) %}
                                {{ _("specify") |capitalize }}
                            {% else %}
                                {{ _("select a letter") |capitalize }}
                            {% endif %}
                            .
                        </div>
                    {% endif %}
                    {% include 'trl.html.j2' %}
                    {% include 'copyr.html.j2' %}
                </div>
                {% include 'js.html.j2' %}
                {{ query_time }}<script>
    // Function for navigation and keyboard shortcuts
    function setupNavigation() {
        var navbarHeight = document.getElementById('fixed-nav').offsetHeight;
        var scrollPaddingTop = navbarHeight + 4;
        document.getElementById('book').style.scrollPaddingTop = scrollPaddingTop + 'px';
        const linkTrm = document.querySelectorAll('.sub-char');
        const linkAdd = document.querySelectorAll('.sup-char');
        let iTrm = -1;
        let iAdd = -1;
        document.addEventListener('keydown', (event) => {
            if (event.altKey && event.key === 't' || event.key === 't' && !{
                    {
                        _("'input', 'textarea'")
                    }
                }.includes(event.target.tagName.toLowerCase())) {
                event.preventDefault();
                let len = linkTrm.length;
                if (iTrm === -1) {
                    iTrm = len - 1;
                    linkTrm {
                        {
                            _("iTrm")
                        }
                    }.focus();
                } else {
                    linkTrm {
                        {
                            _("iTrm")
                        }
                    }.blur();
                    iTrm = (iTrm + len - 1) % len;
                    linkTrm {
                        {
                            _("iTrm")
                        }
                    }.focus();
                }
            }
            if (event.altKey && event.key === 'd' || event.key === 'd' && !{
                    {
                        _("'INPUT', 'TEXTAREA'")
                    }
                }.includes(event.target.tagName)) {
                event.preventDefault();
                if (iAdd === -1) {
                    iAdd = 0;
                    linkAdd {
                        {
                            _("iAdd")
                        }
                    }.parentNode.focus();
                } else {
                    linkAdd {
                        {
                            _("iAdd")
                        }
                    }.parentNode.blur();
                    iAdd = (iAdd + 1) % linkAdd.length;
                    linkAdd {
                        {
                            _("iAdd")
                        }
                    }.parentNode.focus();
                }
            }
        });
        document.querySelectorAll('.sup-char-div').forEach((div) => {
            div.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    const hyperlink = div.querySelector('a:first-child');
                    if (hyperlink) {
                        hyperlink.click();
                    }
                }
            });
        });
    }
    // Function to remove loading overlay
    function removeLoadingOverlay() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('key') || (!urlParams.has('s1'))) {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }
    }
    // Function to auto-select link based on URL parameters
    // Fallback on book if s1 not found and print a warning
    function autoSelectLink() {
        const urlParams = new URLSearchParams(window.location.search);
        // Clic automatique quand s1= ou s2= présent
        if (urlParams.has('s1') || urlParams.has('s2')) {
            if (urlParams.has('key')) return; // Skip si déjà en mode édition
            const s1Param = urlParams.get('s1');
            const s2Param = urlParams.get('s2');
            const sParam = urlParams.get('s');
            const value = s1Param || sParam;
            // Stockage s2 pour updateInputField()
            if (s2Param) {
                localStorage.setItem('s2Tmp', decodeURIComponent(s2Param));
            }
            // Tentative de clic automatique
            if (value && value.trim()) {
                const link = Array.from(document.getElementsByTagName('a')).find(
                    a => a.getAttribute('data-entry') === decodeURIComponent(value) &&
                    a.href.includes('key')
                );
                if (link) {
                    link.click(); // Cible trouvée → Édition automatique
                } else {
                    // Cible introuvable → Stockage pour warning + fallback
                    const decodedValue = decodeURIComponent(s1Param || sParam);
                    if (decodedValue && decodedValue.trim()) {
                        localStorage.setItem('notFoundValue', decodedValue);
                    }
                    // Redirection vers mode consultation (URL nettoyée)
                    urlParams.delete('s1');
                    urlParams.delete('s2');
                    if (s1Param && !sParam) urlParams.set('s', s1Param);
                    window.location.href = window.location.pathname + '?' + urlParams.toString();
                }
            } else {
                urlParams.delete('s1');
                urlParams.delete('s2');
                window.location.href = window.location.pathname + '?' + urlParams.toString();
            }
        }
        // Navigation normale ou après fallback
        else {
            const notFoundValue = localStorage.getItem('notFoundValue');
            if (notFoundValue && notFoundValue.trim()) {
                const valueSpan = document.getElementById('notfound-value');
                const notFoundDiv = document.getElementById('notfound-warning');
                if (valueSpan && notFoundDiv) {
                    valueSpan.textContent = notFoundValue;
                    notFoundDiv.classList.remove('d-none');
                }
            }
            localStorage.removeItem('notFoundValue');
        }
    }
    // Function to update input field
    function updateInputField() {
        const s2 = localStorage.getItem('s2Tmp');
        if (s2 && window.location.href.includes('key=')) {
            const input = document.getElementById('nx_input');
            if (input) {
                input.value = s2;
                localStorage.removeItem('s2Tmp');
            }
        }
    } {
        %
        if (e.s != "") %
    } // Function to shorten the text in sup-char elements
    function shortenSupCharTexts() {
        const urlParams = new URLSearchParams(window.location.search);
        const sParam = urlParams.get('s');
        if (!sParam) return;
        const supCharLinks = document.querySelectorAll('.sup-char');
        const entryCount = supCharLinks.length;
        if (sParam.length > 6 && entryCount > 4 || sParam.length > 4 && entryCount > 10) {
            const supCharLinks = document.querySelectorAll('.sup-char');
            supCharLinks.forEach(link => {
                const fullText = link.textContent.trim();
                if (fullText.startsWith(sParam)) {
                    const suffix = fullText.substring(sParam.length);
                    if (suffix) {
                        const secondLastLetter = sParam.charAt(sParam.length - 2);
                        const lastLetter = sParam.charAt(sParam.length - 1);
                        link.textContent = '…' + secondLastLetter + lastLetter + suffix;
                        if (link.title) {
                            link.title = link.title + ' (' + fullText + ')';
                        } else {
                            link.title = fullText;
                        }
                    }
                }
            });
        }
    } {
        %
        else %
    } // Function to highlight non-Latin characters
    const {
        regex
    } = Regex;
    const scripts = {
        {
            _("'Arabic', 'Armenian', 'Cyrillic', 'Ethiopic', 'Georgian', 'Greek', 'Hebrew', 'Khmer'")
        }
    };

    function highlightNonLatinChars() {
        const divs = document.querySelectorAll('.sup-char-div');
        divs.forEach(div => {
            const link = div.querySelector('.sup-char');
            if (!link) return;
            const char = link.textContent.trim();
            scripts.forEach(script => {
                if (regex`\p{Script=${script}}`.test(char)) {
                    scriptName = script.toLowerCase();
                    div.classList.add(`${scriptName}-char`);
                    link.title += ` (${scriptName})`;
                }
            });
        });
    } {
        % endif %
    }

    function setupStableTooltips() {
        // Configure tooltips with more stability options
        $('{{ _("data-toggle="tooltip"") }}').tooltip({
            trigger: 'hover focus',
            delay: {
                "show": 100,
                "hide": 100
            },
            container: 'body', // This is important - moves tooltips to body
            animation: false, // Disable animations
            boundary: 'window' // Uses window as positioning boundary
        });
    }
    document.addEventListener('DOMContentLoaded', function() {
        setupNavigation();
        setupStableTooltips() {
            %
            if (e.s != "") %
        }
        shortenSupCharTexts();
        {
            %
            else %
        }
        highlightNonLatinChars();
        {
            % endif %
        }
        removeLoadingOverlay();
        autoSelectLink();
        updateInputField();
    });
</script>
            </body>
        </html>
    {% endwith %}
{% endwith %}
