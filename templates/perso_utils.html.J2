{# 
   Display livre d'ascendance
#}

{% set in_place = '-' if roglo else '[in (place)]' %}

{# Copie sans majuscules #}
{% macro tothegen(xx) -%}
[to the %s generation:::{{ xx }}]
{%- endmacro %}

{% macro togen(xx) -%}
{% if xx == 0 %}[specify::generation/generations]0
{% elif xx == 1 %}[to the parents]
{% elif xx == 2 %}[to the grandparents]
{% elif xx == 3 %}[to the great-grandparents]
{% else %}{{ tothegen(nth('[nth (generation)]', xx)) }}{% endif %}
{%- endmacro %}

{% macro thegen(xx) -%}
[the %s generation:::{{ xx }}]
{%- endmacro %}

{% macro gena(xx) -%}
{% if xx == 0 %}[*specify::generation/generations]0
{% elif xx == 1 %}[*the parents]
{% elif xx == 2 %}[*the grandparents]
{% elif xx == 3 %}[*the great-grandparents]
{% else %}{{ thegen(nth('[nth (generation)]', xx)) }}{% endif %}
{%- endmacro %}

{% macro on_side(xx) -%}
[*on {{ xx }}'s side]
{%- endmacro %}

{% macro relation_type_txt(xx, sex) -%}
{% if xx == '[adoptive father/adoptive mother/adoptive parents]2' %}{{ capitalize(nth('[adoptive father/adoptive mother/adoptive parents]', sex)) }}
{% elif xx == '[recognizing father/recognizing mother/recognizing parents]2' %}{{ capitalize(nth('[recognizing father/recognizing mother/recognizing parents]', sex)) }}
{% elif xx == '[candidate father/candidate mother/candidate parents]2' %}{{ capitalize(nth('[candidate father/candidate mother/candidate parents]', sex)) }}
{% elif xx == '[godfather/godmother/godparents]2' %}{{ capitalize(nth('[godfather/godmother/godparents]', sex)) }}
{% elif xx == '[foster father/foster mother/foster parents]2' %}{{ capitalize(nth('[foster father/foster mother/foster parents]', sex)) }}
{% else %}{{ capitalize(xx) }}{% endif %}
{%- endmacro %}

{% macro relation_txt() -%}
{% if on_marriage_date != "" or marriage_place != "" %}
  {% if are_married %}[*married] {{ on_marriage_date }} {% if marriage_place != "" %} {{ in_place }} {{ marriage_place }}{% endif %}.
  {% elif are_not_married %}[*relation/relations]0 {{ on_marriage_date }} {% if marriage_place != "" %} {{ in_place }} {{ marriage_place }}{% endif %}.
  {% elif are_engaged %}[*engaged] {{ on_marriage_date }} {% if marriage_place != "" %} {{ in_place }} {{ marriage_place }}{% endif %}.
  {% elif is_no_sexes_check %}[*relation/relations]0 {{ on_marriage_date }} {% if marriage_place != "" %} {{ in_place }} {{ marriage_place }}{% endif %}.
  {% elif is_no_mention %}{{ capitalize(on_marriage_date) }} {% if marriage_place != "" %} {{ in_place }} {{ marriage_place }}{% endif %}.
  {% endif %}
{% endif %}
{%- endmacro %}

{% macro display_date(xx, with_rowspan) -%}
<td align="right" width="10" {% if xx.nb_families > 1 and with_rowspan == 1 %}rowspan="{{ xx.nb_families }}"{% endif %}>
  {% if xx.has_birth_date %}{{ xx.slash_birth_date }}
  {% elif xx.has_baptism_date %}{{ xx.slash_baptism_date }}
  {% else %}<span class="fp_date_empty">&nbsp;</span>{% endif %}
</td>
<td align="center" {% if xx.nb_families > 1 and with_rowspan == 1 %}rowspan="{{ xx.nb_families }}"{% endif %}>
  {% if xx.has_birth_date or xx.has_baptism_date or xx.has_death_date or xx.has_burial_date %}-{% else %}&nbsp;{% endif %}
</td>
<td align="right" width="10" {% if xx.nb_families > 1 and with_rowspan == 1 %}rowspan="{{ xx.nb_families }}"{% endif %}>
  {% if xx.has_death_date %}{{ xx.slash_death_date }}
  {% elif xx.has_burial_date %}{{ xx.slash_burial_date }}
  {% else %}<span class="fp_date_empty">&nbsp;</span>{% endif %}
</td>
{%- endmacro %}

{% macro display_family_siblings(xx, count) -%}
{% for family in xx.family %}
  {% if family_cnt != 1 %}
<tr>
  <td>{{ spouse }}</td>
  <td align="center">{{ nb_children }}</td>
</tr>
  {% endif %}
{% endfor %}
{%- endmacro %}

{% macro display_siblings(xx, count) -%}
<tr {% if count != 1 %}class="table_content_siblings"{% endif %}>
  <td {% if xx.nb_families > 1 %}rowspan="{{ xx.nb_families }}"{% endif %}>{{ image_MF(xx) }} {{ xx }}</td>
  {{ display_date(xx, 1) }}
  <td>
    {% for family in xx.family %}
      {% if family_cnt == 1 %}{{ spouse }}{% endif %}
    {% endfor %}
  </td>
  <td align="center">
    {% for family in xx.family %}
      {% if family_cnt == 1 %}{{ nb_children }}{% endif %}
    {% endfor %}
  </td>
</tr>
{% if xx.nb_families > 1 %}{{ display_family_siblings(xx, count) }}{% endif %}
{%- endmacro %}

{% macro display_children(xx, count) -%}
<tr{% if count % 2 == 0 %} class="table_content_odd"{% endif %}>
  <td>
    {{ image_MF(xx) }}
    {{ xx }}
  </td>
  {{ display_date(xx, 0) }}
  <td>{{ xx.birth_place }}</td>
</tr>
{%- endmacro %}

{% macro display_union(xx) -%}
<table class="fp_table" cellspacing="0">
  <tr>
    <td width="28"><img src="{{ images_prefix }}marriage.png"></td>
    <td>
      <table>
        <tr>
          <td>
            <b>{{ spouse }} </b>
            {{ spouse.dates }}
          </td>
          <td>
            {% if spouse.has_occupation %}
              <span class="fp_grey_italic">[*occupation/occupations]0[:]</span>
              {{ spouse.occupation }}
            {% endif %}
          </td>
        </tr>
        <tr>
          <td colspan="2">
            {{ relation_txt() }}
            {% if xx.computable_marriage_age %}
              {% if are_married or are_engaged %}{{ capitalize(nth('[groom/bride]', xx.sex)) }}[:] {{ xx.marriage_age }} 
              {% else %}{{ capitalize(nth('[conjoint/conjointe]', xx.sex)) }}[:] {{ xx.marriage_age }} {% endif %}
            {% endif %}
            {% if xx.computable_marriage_age and spouse.computable_marriage_age %} - {% endif %}
            {% if spouse.computable_marriage_age %}
              {% if are_married or are_engaged %}{{ capitalize(nth('[groom/bride]', spouse.sex)) }}[:] {{ spouse.marriage_age }}
              {% else %}{{ capitalize(nth('[conjoint/conjointe]', spouse.sex)) }}[:] {{ spouse.marriage_age }}{% endif %}
            {% endif %}
          </td>
        </tr>
        {% if are_divorced or are_separated %}
          <tr>
            <td colspan="2">
              {% if are_divorced %}[*divorced] {{ on_divorce_date }}. {% endif %}
              {% if are_separated %}[*separated] {{ on_separation_date }}. {% endif %}
            </td>
          </tr>
        {% endif %}
      </table>
    </td>
  </tr>
</table><br>

{% if evar.children == "on" and has_children %}
  <table class="fp_table_children" cellspacing="0">
    <tr class="fp_grey">
      <td>[*child/children]1</td>
      <td colspan="3">[*date/dates]1</td>
      <td>[*where born]</td>
    </tr>
    {% for child in child %}
      {{ display_children(child, child_cnt) }}
    {% endfor %}
  </table><br>
{% endif %}

{% if evar.comm == "on" and (has_comment or has_marriage_note) %}
  <table class="fp_marriage_notes">
    <tr>
      <td>
        <span class="textcolor">[*marriage notes/marriages notes]0[:]</span> {{ comment }}
        {% if has_marriage_note %}{{ marriage_note }}{% endif %}
      </td>
    </tr>
  </table><br>
{% endif %}
{%- endmacro %}

{% macro access_ind(nnn) -%}
{{ nnn }} {{ nnn.dates }}
{%- endmacro %}

{% macro access(num, nnn) -%}
{{ num }}_
{% if num == "1" %}{{ nnn }}{{ nnn.title }}{{ nnn.dates }}<br>
{% else %}{{ access_ind(nnn) }}<br>{% endif %}
{%- endmacro %}

{% macro display_tree(xx) -%}
{% if xx.father.has_parents %}
  {% if xx.father.father.has_parents %}
    {% if xx.father.father.father.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("16", xx.father.father.father.father) }}
    {% endif %}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("8", xx.father.father.father) }}
    {% if xx.father.father.father.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("17", xx.father.father.father.mother) }}
    {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br>
    {% endif %}
  {% endif %}
{% endif %}

{% if xx.father.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("4", xx.father.father) }}
{% endif %}

{% if xx.father.has_parents %}
  {% if xx.father.father.has_parents %}
    {% if xx.father.father.mother.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("18", xx.father.father.mother.father) }}
    {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
    {% endif %}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("9", xx.father.father.mother) }}
    {% if xx.father.father.mother.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("19", xx.father.father.mother.mother) }}
    {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br>
    {% endif %}
  {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br>
  {% endif %}
{% endif %}

|{{ access("2", xx.father) }}

{% if xx.father.has_parents %}
  {% if xx.father.mother.has_parents %}
    {% if xx.father.mother.father.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("20", xx.father.mother.father.father) }}
    {% else %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
    {% endif %}

|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("10", xx.father.mother.father) }}
    {% if xx.father.mother.father.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("21", xx.father.mother.father.mother) }}
    {% else %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br>
    {% endif %}
  {% else %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
  {% endif %}
{% endif %}

{% if xx.father.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("5", xx.father.mother) }}
{% endif %}

{% if xx.father.has_parents %}
  {% if xx.father.mother.has_parents %}
    {% if xx.father.mother.mother.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("22", xx.father.mother.mother.father) }}
    {% else %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
    {% endif %}

|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("11", xx.father.mother.mother) }}
    {% if xx.father.mother.mother.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("23", xx.father.mother.mother.mother) }}
    {% endif %}
  {% endif %}
{% endif %}

|--{{ access("1", xx) }}

{% if xx.mother.has_parents %}
  {% if xx.mother.father.has_parents %}
    {% if xx.mother.father.father.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("24", xx.mother.father.father.father) }}
    {% endif %}

|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("12", xx.mother.father.father) }}
    {% if xx.mother.father.father.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("25", xx.mother.father.father.mother) }}
    {% else %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br>
    {% endif %}
  {% endif %}
{% endif %}

{% if xx.mother.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("6", xx.mother.father) }}
{% endif %}

{% if xx.mother.has_parents %}
  {% if xx.mother.father.has_parents %}
    {% if xx.mother.father.mother.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("26", xx.mother.father.mother.father) }}
    {% else %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
    {% endif %}

|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("13", xx.mother.father.mother) }}
    {% if xx.mother.father.mother.has_parents %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("27", xx.mother.father.mother.mother) }}
    {% endif %}
  {% else %}
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br>
  {% endif %}
{% endif %}

|{{ access("3", xx.mother) }}

{% if xx.mother.has_parents %}
  {% if xx.mother.mother.has_parents %}
    {% if xx.mother.mother.father.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("28", xx.mother.mother.father.father) }}
    {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
    {% endif %}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("14", xx.mother.mother.father) }}
    {% if xx.mother.mother.father.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("29", xx.mother.mother.father.mother) }}
    {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/<br>
    {% endif %}
  {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
  {% endif %}
{% endif %}

{% if xx.mother.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("7", xx.mother.mother) }}
{% endif %}

{% if xx.mother.has_parents %}
  {% if xx.mother.mother.has_parents %}
    {% if xx.mother.mother.mother.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("15", xx.mother.mother.mother) }}
    {% if xx.mother.mother.mother.has_parents %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯¯¯¯¯|
{{ access("31", xx.mother.mother.mother.mother) }}
    {% endif %}
  {% endif %}
{% endif %}
{%- endmacro %}

{% macro print_long_ind(xx) -%}
<div class="fp_person">
  <table width="100%">
    <tr>
      <td>
        <table>
          <tr>
            <td><h2><span class="highlight"><a name="ind_{{ xx.index }}">{{ xx }}</a></span></h2></td>
            <td>{{ image_MF(xx) }}</td>
          </tr>
        </table>
      </td>
      <td align="right">
        {% if evar.sosa == "on" and xx.has_sosa %}
          <span>
            <img src="{{ images_prefix }}sosa.png" alt="sosa" title="sosa"> [*Sosa] {{ xx.sosa }}
          </span>
        {% endif %}
      </td>
    </tr>
  </table>
  <div class="fp_person_info">
    {% if e.im == "" and xx.has_image %}
      <table width="100%">
        <tr>
          <td width="30">
            <img src="{{ xx.image_url }}"{{ xx.image_size }} alt="[image/images]0" border="0">
          </td>
          <td valign="top">
    {% endif %}
    <ul class="fp_person_info_ul">
      {% if xx.has_aliases %}
        <li>
          <span class="fp_grey_italic">[*alias][:]</span>
          {% for alias in xx.alias %}
            <em>{% if not is_first %},{% endif %}&nbsp;{{ alias }}</em>
          {% endfor %}
        </li>
      {% endif %}
      {% if xx.has_nobility_titles %}
        <li>
          <span class="fp_grey_italic">[*title/titles]1[:]</span>
          <em>
            {% for nobility_title in xx.nobility_title %}
              {% if not is_first %},{% endif %}
              {{ nobility_title }}
            {% endfor %}
          </em>
        </li>
      {% endif %}
      {% if xx.has_occupation %}
        <li>
          <span class="fp_grey_italic">[*occupation/occupations]0[:]</span>
          {{ xx.occupation }}
        </li>
      {% endif %}
      {% if (xx.has_aliases or xx.has_nobility_titles or xx.has_occupation) and ((xx.has_birth_date or xx.has_birth_place) or (xx.has_baptism_date or xx.has_baptism_place) or (xx.has_death_date or xx.has_death_place) or (xx.has_burial_date or xx.has_burial_place)) %}
        <li><hr></li>
      {% endif %}
      {% if xx.has_birth_date or xx.has_birth_place %}
        <li>
          <span class="fp_grey_italic">{{ capitalize(nth('[born]', xx.sex)) }}</span>
          {{ xx.on_birth_date }}
          {% if xx.has_birth_place %} {{ in_place }} {{ xx.birth_place }}{% endif %}
        </li>
      {% endif %}
      {% if xx.has_baptism_date or xx.has_baptism_place %}
        <li>
          <span class="fp_grey_italic">{{ capitalize(nth('[baptized]', xx.sex)) }}</span>
          {{ xx.on_baptism_date }}
          {% if xx.has_baptism_place %} {{ in_place }} {{ xx.baptism_place }}{% endif %}
        </li>
      {% endif %}
      {% if xx.has_death_date or xx.has_death_place %}
        <li>
          <span class="fp_grey_italic">{{ capitalize(nth('[died]', xx.sex)) }}</span>
          {{ xx.on_death_date }}
          {% if xx.computable_death_age %} [aged] {{ xx.death_age }},{% endif %}
          {% if xx.has_death_place %} {{ in_place }} {{ xx.death_place }}{% endif %}
        </li>
      {% endif %}
      {% if xx.is_buried %}
        <li>
          <span class="fp_grey_italic">{{ capitalize(nth('[buried]', xx.sex)) }}</span>
          {{ xx.on_burial_date }}
          {% if xx.has_burial_place %} {{ in_place }} {{ xx.burial_place }}{% endif %}
        </li>
      {% endif %}
      {% if xx.is_cremated %}
        <li>
          <span class="fp_grey_italic">{{ capitalize(nth('[cremated]', xx.sex)) }}</span>
          {{ xx.on_cremation_date }}
          {% if xx.has_cremation_place %} {{ in_place }} {{ xx.cremation_place }}{% endif %}
        </li>
      {% endif %}
    </ul>
    {% if e.im == "" and xx.has_image %}
      </td></tr></table>
    {% endif %}
  </div>
</div>

{% if evar.parents == "on" and xx.has_parents %}
  <table class="fp_table_parent" cellspacing="0">
    <tr><th colspan="2">[*parents]</th></tr>
    <tr>
      <td>
        <span class="fp_grey_italic">{{ capitalize(nth('[father/mother]', xx.father.sex)) }}[:]</span>
        {{ xx.father }}
        {% if xx.father_age_at_birth != "" %} ({{ xx.father_age_at_birth }}){% endif %}
      </td>
      <td>
        {% if xx.father.has_occupation %}
          <span class="fp_grey_italic">[*occupation/occupations]0[:]</span>
          {{ xx.father.occupation }}
        {% endif %}
      </td>
    </tr>
    <tr>
      <td>
        <span class="fp_grey_italic">{{ capitalize(nth('[father/mother]', xx.mother.sex)) }}[:]</span>
        {{ xx.mother }}
        {% if xx.mother_age_at_birth != "" %} ({{ xx.mother_age_at_birth }}){% endif %}
      </td>
      <td>
        {% if xx.mother.has_occupation %}
          <span class="fp_grey_italic">[*occupation/occupations]0[:]</span>
          {{ xx.mother.occupation }}
        {% endif %}
      </td>
    </tr>
  </table>
{% endif %}

{% if evar.siblings == "on" and (xx.has_siblings or (xx.has_parents and (xx.father.nb_families > 1 or xx.mother.nb_families > 1))) %}
  <div style="page-break-inside:avoid;">
    <table class="fp_table_siblings" cellspacing="0">
      {% if xx.has_siblings %}
        <tr><th colspan="6">[*full siblings]</th></tr>
        <tr class="fp_grey">
          <td>[*name]</td>
          <td colspan="3">[*date/dates]1</td>
          <td>[*spouse/spouses]0</td>
          <td align="center">[*child/children]1</td>
        </tr>
        {% for child in xx.father.child %}
          {{ display_siblings(child, child_cnt) }}
        {% endfor %}
      {% endif %}

      {% if xx.has_parents %}
        {% if xx.father.nb_families > 1 or xx.mother.nb_families > 1 %}
          {{ reset_count() }}
          {% for family in xx.father.family %}
            {% if spouse.index != xx.mother.index %}
              {% if nb_children > 0 %}{{ incr_count() }}{% endif %}
            {% endif %}
          {% endfor %}
          {% set half_father = count %}
          {{ reset_count() }}
          {% for family in xx.mother.family %}
            {% if spouse.index != xx.father.index %}
              {% if nb_children > 0 %}{{ incr_count() }}{% endif %}
            {% endif %}
          {% endfor %}
          {% set half_mother = count %}
          {% if half_father != 0 or half_mother != 0 %}
            {% if xx.has_siblings %}<tr><td colspan="6">&nbsp;</td></tr>{% endif %}
            <tr><th colspan="6">[*half-brothers/half-sisters/half-siblings]2</th></tr>
            <tr class="fp_grey">
              <td>[*name]</td>
              <td colspan="3">[*date/dates]1</td>
              <td>[*spouse/spouses]0</td>
              <td align="center">[*child/children]1</td>
            </tr>
            {% if half_father != 0 %}
              {% for family in xx.father.family %}
                {% if spouse.index != xx.mother.index and half_father != 0 and spouse.has_children %}
                  {% if has_children %}
                    <tr class="fp_half_siblings">
                      <td colspan="6">{{ on_side(xx.father) }} [with] {{ spouse }}</td>
                    </tr>
                    {% for child in child %}
                      {{ display_siblings(child, family_cnt) }}
                    {% endfor %}
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {% if half_mother != 0 %}
              {% for family in xx.mother.family %}
                {% if spouse.index != xx.father.index and half_mother != 0 and spouse.has_children %}
                  {% if has_children %}
                    <tr class="fp_half_siblings">
                      <td colspan="6">{{ on_side(xx.mother) }} [with] {{ spouse }}</td>
                    </tr>
                    {% for child in child %}
                      {{ display_siblings(child, family_cnt) }}
                    {% endfor %}
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endif %}
          {% endif %}
        {% endif %}
      {% endif %}
    </table>
  </div>
{% endif %}

{{ reset_count() }}
{% if xx.has_families %}
  {% for family in xx.family %}
    {% if has_witnesses %}
      {{ incr_count() }}
    {% endif %}
  {% endfor %}
{% endif %}
{% if evar.rel == "on" and (xx.has_relations or count > 0) %}
  <div style="page-break-inside:avoid;">
    <table class="fp_table_relations" cellspacing="0">
      <tr><th colspan="4" class="background-color">[*relation/relations]1</th></tr>
      <tr class="fp_grey">
        <td class="borderna">[*name]</td>
        <td class="borderna" colspan="3">[*date/dates]1</td>
      </tr>
      {% for relation in xx.relation %}
        {% if has_relation_him and has_relation_her %}
          <tr class="table_content_relations">
            <td class="borderna">
              {{ image_MF(relation_him) }} {{ relation_him }} 
              ({{ relation_type_txt(relation_type, relation_him.sex) }})
            </td>
            {{ display_date(relation_him, 0) }}
          </tr>
          <tr class="table_content_relations">
            <td class="borderna">
              {{ image_MF(relation_her) }} {{ relation_her }} 
              ({{ relation_type_txt(relation_type, relation_her.sex) }})
            </td>
            {{ display_date(relation_her, 0) }}
          </tr>
        {% elif has_relation_him %}
          <tr class="table_content_relations">
            <td class="borderna">
              {{ image_MF(relation_him) }} {{ relation_him }} 
              ({{ capitalize(relation_type) }})
            </td>
            {{ display_date(relation_him, 0) }}
          </tr>
        {% elif has_relation_her %}
          <tr class="table_content_relations">
            <td class="borderna">
              {{ image_MF(relation_her) }} {{ relation_her }} 
              ({{ capitalize(relation_type) }})
            </td>
            {{ display_date(relation_her, 0) }}
          </tr>
        {% endif %}
      {% endfor %}
      {% for related in xx.related %}
        <tr class="table_content_relations">
          <td class="borderna">
            {{ image_MF(related) }} {{ related }}  
            {% if related == '[foster son/foster daughter/foster child]0' %}
              ({{ capitalize('[foster son/foster daughter/foster child]2') }})
            {% elif related == '[foster son/foster daughter/foster child]1' %}
              ({{ capitalize('[foster son/foster daughter/foster child]2') }})
            {% else %}
              ({{ capitalize(related_type) }})
            {% endif %}
          </td>
          {{ display_date(related, 0) }}
        </tr>
      {% endfor %}
      {% if xx.has_families %}
        {% for family in xx.family %}
          {% if has_witnesses %}
            {% for witness in witness %}
              <tr>
                <td class="borderna">
                  {{ image_MF(witness) }} {{ witness }} 
                  ([*witness/witnesses]0)
                </td>
                {{ display_date(witness, 0) }}
              </tr>
            {% endfor %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% for event_witness_relation in xx.event_witness_relation %}
        <tr class="table_content_relations">
          <td class="borderna">
            {{ image_MF(event_witness_relation.person) }} {{ event_witness_relation.person }} 
            {% if event_witness_relation.event.spouse != "" %}
              [and]
              {{ image_MF(event_witness_relation.event.spouse) }} {{ event_witness_relation.event.spouse }} 
            {% endif %}
            ({{ capitalize(event_witness_relation_kind) }} : 
            {{ event_witness_relation.event.name }})
          </td>
          {{ display_date(event_witness_relation.person, 0) }}
        </tr>
      {% endfor %}
    </table>
  </div>
{% endif %}

{% if evar.marr == "on" and xx.has_families %}
  <div style="page-break-inside:avoid;">
    <table class="fp_table_marriage" cellspacing="0">
      <tr>
        <th>
          [*marriage/marriages]f {% if evar.children == "on" and xx.has_children %}[and] [child/children]c{% endif %}
        </th>
      </tr>
      <tr>
        <td>
          {% for family in xx.family %}
            {{ display_union(xx) }}
            {% if family_cnt != xx.nb_families %}<hr class="fp_family_separator">{% endif %}
          {% endfor %}
        </td>
      </tr>
    </table>
  </div>
{% endif %}

{% if evar.note == "on" and (xx.has_notes or xx.has_event) %}
  <div style="page-break-inside:avoid;">
    <table class="fp_table" cellspacing="0">
      <tr><th>[*note/notes]1</th></tr>
      <tr><td class="fp_notes">
        {{ xx.notes }}
        {% if xx.has_event %}
          <table>
            {% for event in xx.event %}
              <tr>
                <td valign="top" style="white-space: nowrap;" width="1">
                  <span class="edate">
                    {% if event.has_date %}{{ event.date }} :
                    {% else %}--- :
                    {% endif %}
                  </span>
                </td>
                <td valign="top">
                  <span>
                    {{ capitalize(event.name) }} 
                    {% if event.has_spouse %}([with] {{ event.spouse }}){% endif %}
                    {% if event.has_place %} - {{ event.place }} {% endif %}
                  </span>
                  {% if event.has_witnesses %}
                    <p style="margin:0;">
                      {% for event_witness in event_witness %}
                        <span>{{ capitalize(event_witness_kind) }}[:]</span>
                        {{ short_display_person(event_witness) }}<br>
                      {% endfor %}
                    </p>
                  {% endif %}
                  {% if event.has_note %}<div>{{ event.note }}</div>{% endif %}
                  {% if event.has_src %}<span><em>[*source/sources]1[:] {{ event.src }}</em>.</span>{% endif %}
                </td>
              </tr>
            {% endfor %}
          </table>
        {% endif %}
      </td></tr>
    </table>
  </div>
{% endif %}

{% if evar.asc == "on" and xx.has_parents %}
  <div style="page-break-inside:avoid;">
    <table class="fp_table" cellspacing="0">
      <tr><th>[*ascendants tree]</th></tr>
      <tr><td>{{ display_tree(xx) }}</td></tr>
    </table>
  </div>
{% endif %}

{% if evar.src == "on" and xx.has_sources %}
  <div style="page-break-inside:avoid;">
    <table class="fp_table" cellspacing="0">
      <tr><th>[*source/sources]1</th></tr>
      <tr>
        <td>
          <ul class="fp_source">
            {% for source in xx.source %}
              <li>{{ source_type }}[:] {{ source }}</li>
            {% endfor %}
          </ul>
        </td>
      </tr>
    </table>
  </div>
{% endif %}
{%- endmacro %}

<div class="page_max">
  {% set nb_gen = min(evar.v, max_anc_level) %}
  {% if evar.v > 1 %}
    <span width="100%">
      <hr>
      {{ capitalize(nth('[summary book ascendants]', 3)) }}
      {% if evar.only == "on" %}. [*only] {{ gena(nb_gen) }}{% else %} {{ togen(nb_gen) }}{% endif %}.
      <hr>
    </span>
    <ul class="fp_ul_summary">
      {% for ancestor_level in ancestor_level(nb_gen) %}
        {% if level > 0 %}
          {{ lazy_print() }}
            <li><b>[*generation/generations]0 {{ level }}</b></li>
          {{ lazy_force() }}
        {% endif %}
        {% if evar.only != "on" or (evar.only == "on" and level == evar.v) %}
          {% for ancestor in ancestor %}
            {{ lazy_force() }}
            {% if ancestor.same == "" %}
              <li>
                <a href="#ind_{{ ancestor.index }}" class="see-more">{{ ancestor }}</a>
                {% if evar.sosa == "on" and ancestor.has_sosa %}
                  ([n° Sosa]&nbsp;: {{ ancestor.sosa }})
                {% endif %}
              </li>
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endfor %}
    </ul>
    <p style="page-break-after:always;">&nbsp;</p>
  {% endif %}

  {% for ancestor_level in ancestor_level(nb_gen) %}
    {% if evar.only != "on" or (evar.only == "on" and level == evar.v) %}
      {% for ancestor in ancestor %}
        {% if ancestor.same == "" %}
          {{ print_long_ind(ancestor) }}
          {% if not (is_last and level == nb_gen) %}
            <p style="page-break-after:always;">&nbsp;</p>
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endfor %}
</div>nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_____|
{{ access("30", xx.mother.mother.mother.father) }}
    {% else %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
    {% endif %}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&