{# --------------------------------------------------------------------
  Ported from: perso.txt v7.1 (08/12/2023 23:04:39)
  
  Notes:
  - Legacy %variable; → {{ variable }}
  - %if;condition; → {% if condition %}
  - %include;file → {% include 'file.html.j2' %}
  - %apply;function → {{ function() }}
  - %let;var;value%in; → {% set var = value %}
  
  Required context variables:
  - person object (p) with attributes: nn, has_public_name, public_name, 
    qualifier, surname, occ, first_name, has_qualifiers
  - bvar, evar dictionaries
  - lang, images_prefix, body_prop, prefix
  - Functions: t(), apply(), get_mod(), mm(), oo()
  -------------------------------------------------------------------- #}

<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <!-- $Id: perso.txt {{ version }} 08/12/2023 23:04:39 $ -->
  <!-- Copyright (c) 1998-2007 INRIA -->
  <title>{{ p.nn }}
    {% if p.has_public_name %}
      {% if p.has_qualifiers %}{{ p.public_name }} {{ p.qualifier }}
      {% else %}{{ p.public_name }} {{ p.surname }}{% if p.occ and p.occ != "" and p.occ != 0 %} ({{ p.occ }}){% endif %}{% endif %}
    {% else %}
      {% if p.has_qualifiers %}{{ p.first_name }} {{ p.qualifier }}
      {% else %}{{ p.first_name }} {{ p.surname }}{% if p.occ and p.occ != "" and p.occ != 0 %} ({{ p.occ }}){% endif %}{% endif %}
    {% endif %}
  </title>
  {% if bvar.robot_index == "yes" %}
    <meta name="robots" content="index,follow">
  {% else %}
    <meta name="robots" content="none">
  {% endif %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="{{ images_prefix }}favicon_gwd.png">
  <link rel="apple-touch-icon" href="{{ images_prefix }}favicon_gwd.png">
  {% include 'css.html.j2' %}
</head>

<body{{ body_prop | safe }}>

{% include 'hed.html.j2' %}

{{ message_to_wizard | safe }}

<a href="#content" class="sr-only sr-only-focusable">{{ t('*skip to main content', 0) }}</a>

<div class="container{% if evar.wide == 'on' %}-fluid{% endif %}">

{% include 'perso_utils.html.j2' %}

{% include 'menubar.html.j2' %}

<div id="content" tabindex="-1">

{# Note: p_mod can be from (b)bvar.p_mod or (e)evar.p_mod #}

{% set p_mod = evar.get('p_mod', bvar.get('p_mod', '')) %}

{% if p_mod == "zz" or (bvar.get('p_mod') == "zz" and not evar.get('p_mod')) or 
      (not bvar.get('p_mod') and not evar.get('p_mod')) %}
  
  {# Static rendering mode #}
  <div class="row">
    {# Be careful: h1 is col-12 for full width, then an opening <div class="col-8"> in individu.txt #}
    
    {% set op_m = 3 %}
    {% include 'modules/individu.html.j2' %}
    
    {% set op_m = 2 %}
    {% include 'modules/unions.html.j2' %}
    
    {% set op_m = 1 %}
    {% include 'modules/chronologie.html.j2' %}
    
    {% set op_m = 1 %}
    {% include 'modules/notes.html.j2' %}
    
    {% set op_m = 2 %}
    {% include 'modules/sources.html.j2' %}
    
    {% if not p_mod or p_mod == "zz" %}</div>{% endif %} {# end of <div class="col-8"> from individu.txt #}
    
    <div class="col-lg-4">
      {% set op_m = 2 %}
      {% include 'modules/arbre_3gen_photo.html.j2' %}
      
      {% set op_m = 1 %}
      {% include 'modules/fratrie.html.j2' %}
      
      {% set op_m = 1 %}
      {% include 'modules/relations.html.j2' %}
    </div>
  </div>

{% else %}
  
  {# Dynamic rendering mode #}
  <div class="mt-2">
    {% for i in range(0, p_mod_nbr) %}
      {% set mmi = mm(i) %}
      {% set ooi = oo(i) %}
      {% if mmi and mmi != "" and ooi and ooi != 0 %}
        {{ get_mod(mmi, ooi) | safe }}
      {% endif %}
    {% endfor %}
  </div>

{% endif %}

{% if evar.get('opt') == 'misc' %}
  {{ misc_names | safe }}<p>
{% endif %}

{% if not cancel_links %}
  {% include 'trl.html.j2' %}
  {% include 'copyr.html.j2' %}
  {{ query_time | safe }}
{% endif %}

</div>
</div>

{% include 'js.html.j2' %}

<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script>

</body>
</html>